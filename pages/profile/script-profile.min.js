"use strict";function a(){t.src=SERVER_URL+l.photoUrl,r.innerText=l.name,o.innerText=l.surname,n.innerText=l.email,s.innerText=l.location,i.innerText=l.age}function e(t){var e=t.querySelector(".modal-btn-close_js");t.classList.remove("hidden"),g.classList.remove("hidden"),e.addEventListener("click",function(){t.classList.add("hidden"),g.classList.add("hidden")}),window.addEventListener("keydown",function(e){"Escape"===e.key&&(t.classList.add("hidden"),g.classList.add("hidden"))})}var t,r,o,n,s,i,l,d,c,u,m,v,h,f,g,S,p,E,y,w,j,k,q,I,L;m=document.querySelector(".profile_js"),v=document.querySelector(".profile-spinner_js"),h=document.querySelector(".edit-data-modal_js"),f=document.querySelector(".edit-password-modal_js"),g=document.querySelector(".modal-overlay_js"),S=document.forms.editPasswordForm,p=document.forms.editDataForm,E=document.querySelector(".delete-user-btn_js"),m&&v&&S&&p&&h&&f&&(t=m.querySelector(".profile-image_js"),r=m.querySelector(".profile-name_js"),o=m.querySelector(".profile-sname_js"),n=m.querySelector(".profile-email_js"),s=m.querySelector(".profile-location_js"),i=m.querySelector(".profile-age_js"),l=null,v.classList.remove("hidden"),sendrequest({method:"GET",url:"/api/users/"+localStorage.getItem("userId")}).then(function(e){return e.json()}).then(function(e){e.success?(l=e.data,a()):window.location.pathname="/"}).finally(function(){v.classList.add("hidden")}),S=document.querySelector(".change-data-btn_js"),m=document.querySelector(".change-password-btn_js"),S&&m&&(S.addEventListener("click",function(){p.email.value=l.email,p.surname.value=l.surname,p.name.value=l.name,p.location.value=l.location,p.age.value=l.age,e(h)}),m.addEventListener("click",function(){e(f)})),d=p.querySelector(".fakeFile-input_js"),c=p.elements.avatar,u=p.querySelector(".edit-data-btn_js"),c.addEventListener("click",function(){c.value=null}),c.addEventListener("change",function(){var e=c.value.split("\\");d.innerText=e[e.length-1]}),p.addEventListener("submit",function(e){e.preventDefault();var t=p.elements.email,r=p.elements.name,o=p.elements.location,n=p.elements.age,s=p.elements.surname,e="";if(0==t.value.trim().length)return e='Please enter a valid email address (your entry is not in the format "somebody@example.com")',setError(t,e,void 0,void 0),void setBtnError(u);if(!emailCheck(t.value))return e='Please enter a valid email address (your entry is not in the format "somebody@example.com")',setError(t,e,void 0,void 0),void setBtnError(u);if(setNoError(t,"All right"),setBtnValid(u),0==r.value.trim().length)return e="This field is required",setError(r,e,void 0,void 0),void setBtnError(u);if(setNoError(r,"All right"),setBtnValid(u),0==s.value.trim().length)return e="This field is required",setError(s,e,void 0,void 0),void setBtnError(u);if(setNoError(s,"All right"),setBtnValid(u),0===n.value.trim().length)return e="This field is required",setError(n,e,void 0,void 0),void setBtnError(u);if(+n.value<18)return e="The age must be over 18 years old",setError(n,e,void 0,void 0),void setBtnError(u);if(setNoError(n,"All right"),setBtnValid(u),0==o.value.trim().length)return e="This field is required",setError(o,e,void 0,void 0),void setBtnError(u);setNoError(o,"All right"),setBtnValid(u);o=new FormData(p);controlSpinner(h),sendrequest({method:"PUT",url:"/api/users/",body:o,headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return 401!==e.status&&403!==e.status||(localStorage.removeItem("token"),localStorage.removeItem("userId"),window.location.pathname="/"),e.json()}).then(function(e){if(controlSpinner(h,!1),!e.success)throw e;l=e.data,a(),clearMessage(h),visualMessageSendForm(!0,h)}).catch(function(e){console.log(e),controlSpinner(h,!1),visualMessageSendForm(!1,h)})}),E.addEventListener("click",function(){sendrequest({method:"DELETE",url:"/api/users/"+localStorage.getItem("userId"),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return 401!==e.status&&403!==e.status||(localStorage.removeItem("token"),localStorage.removeItem("userId"),window.location.pathname="/"),e.json()}).then(function(e){if(!e.success)throw e;localStorage.removeItem("token"),localStorage.removeItem("userId"),window.location.pathname="/",visualMessageSendForm(!0)}).catch(function(e){console.log(e),visualMessageSendForm(!1)})}),window.addEventListener("keydown",function(e){"Escape"===e.key&&(localStorage.removeItem("token"),localStorage.removeItem("userId"),renderMenu())})),I=document.forms.editPasswordForm,L=document.querySelector(".edit-password-modal_js"),I&&L&&(y=I.elements.oldPassword,w=I.elements.newPassword,j=I.elements.repeatNewPassword,k=I.querySelector(".edit-password-btn_js"),q="oldPassword",I.addEventListener("submit",function(t){t.preventDefault();var e,r=errorChecker(void 0,y.value,void 0,void 0,void 0,void 0,void 0,void 0,void 0,w.value,j.value);Object.keys(r[0]).length?(setBtnError(k),Object.keys(r[0]).forEach(function(e){var t,e="password"===e?(t=r[0][e],I.elements[q]):(t=r[0][e],I.elements[e]);setError(e,t,w,I)})):setBtnValid(k),Object.keys(r[1]).length&&Object.keys(r[1]).forEach(function(e){var t,e="password"===e?(t=r[1][e],I.elements[q]):(t=r[1][e],I.elements[e]);setNoError(e,t)}),Object.keys(r[0]).length||(e={oldPassword:y.value,newPassword:w.value},controlSpinner(L),sendrequest({method:"PUT",url:"/api/users",body:JSON.stringify(e),headers:{"x-access-token":localStorage.getItem("token"),"Content-Type":"application/json"}}).then(function(e){return 401!==e.status&&403!==e.status||(localStorage.removeItem("token"),localStorage.removeItem("userId"),window.location.pathname="/"),e.json()}).then(function(e){if(console.log(e),controlSpinner(L,!1),!e.success)throw e;clearMessage(L),visualMessageSendForm(!0,L)}).catch(function(e){controlSpinner(L,!1),t.target.reset(),clearMessage(L),visualMessageSendForm(!1,L)}))}));